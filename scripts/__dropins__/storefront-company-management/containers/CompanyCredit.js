/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as e,jsxs as b}from"@dropins/tools/preact-jsx-runtime.js";import{useState as h,useRef as _,useMemo as x,useCallback as P,useEffect as w}from"@dropins/tools/preact-hooks.js";/* empty css                                   */import{Card as R,IllustratedMessage as z,Price as E,Table as j,Pagination as G,ProgressSpinner as Z,Picker as K}from"@dropins/tools/components.js";import{events as F}from"@dropins/tools/event-bus.js";import{g as W,a as q}from"../chunks/getCompanyCreditHistory.js";import{d as J}from"../chunks/CompanyLoaders.js";import{useText as O}from"@dropins/tools/i18n.js";import{classes as A}from"@dropins/tools/lib.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";const Q=10,M=1,V=({initialParams:r={},translations:o})=>{const[i,a]=h([]),[l,d]=h(!1),[n,s]=h(r.currentPage||M),[y,N]=h(r.pageSize||Q),[S,p]=h(0),[u,f]=h(1),[T,L]=h(""),v=_(o);v.current=o;const I=_(r),B=x(()=>({...I.current,currentPage:n,pageSize:y}),[n,y]),t=P(async()=>{var c;d(!0);try{const m=await W(B);m?(a(m.items),p(m.totalCount||m.items.length),f(((c=m.pageInfo)==null?void 0:c.totalPages)||1),L(v.current.ariaDataLoaded.replace("{count}",m.items.length.toString()))):(a([]),p(0),f(1),L(v.current.ariaDataLoaded.replace("{count}","0")))}catch(m){console.error("Failed to load company credit history:",m),a([]),p(0),f(1),L(v.current.ariaDataError)}finally{d(!1)}},[B]);w(()=>{t()},[t]);const C=P(c=>{let m;if(typeof c=="string")m=c;else if("target"in c&&c.target&&"value"in c.target)m=c.target.value;else return;const k=parseInt(m,10);isNaN(k)||(N(k),s(M))},[]),g=P(()=>{n>1&&s(n-1)},[n]),H=P(()=>{n<u&&s(n+1)},[n,u]),D=P(c=>{c>=1&&c<=u&&c!==n&&s(c)},[n,u]),U=P(async()=>{await t()},[t]);return{items:i,currentPage:n,pageSize:y,totalItems:S,totalPages:u,loading:l,announcement:T,handlePageSizeChange:C,handlePreviousPage:g,handleNextPage:H,handlePageChange:D,refreshCreditHistory:U}},X=({className:r,...o})=>{var u,f,T,L,v,I,B,t,C;const i=O({creditAvailable:"Company.CompanyCredit.creditAvailable",creditLimit:"Company.CompanyCredit.creditLimit",outstandingBalance:"Company.CompanyCredit.outstandingBalance",loading:"Company.shared.messages.loading",loadError:"Company.CompanyCredit.messages.loadError",emptyTitle:"Company.CompanyCredit.emptyState.title",emptyMessage:"Company.CompanyCredit.emptyState.message"}),[a,l]=h(null),[d,n]=h(!1),[s,y]=h(null),N=_(!1),S=_(!1),p=P(async()=>{if(!N.current){N.current=!0,n(!0),y(null);try{const g=await q();l(g)}catch(g){console.error("Failed to load company credit:",g),y(i.loadError),l(null)}finally{n(!1),N.current=!1}}},[i.loadError]);return w(()=>{S.current||(S.current=!0,p())},[p]),w(()=>{const g=()=>{l(null),S.current=!1,p()},H=F.on("companyContext/changed",g,{eager:!0});return()=>{var D;(D=H==null?void 0:H.off)==null||D.call(H)}},[p]),d?e("div",{...o,className:r,children:e(R,{variant:"primary",className:"company-management-company-credit-loading",children:e(J,{testId:"companyCreditLoader"})})}):s?e("div",{...o,className:r,children:e("div",{className:"company-management-company-credit-empty",children:e(z,{heading:s,message:e("p",{children:s})})})}):e("div",{...o,className:r,children:a===null||!a.credit?e("div",{className:"company-management-company-credit-empty",children:e(z,{heading:i.emptyTitle||"No Credit Information",message:e("p",{children:i.emptyMessage||"There is no credit information to display."})})}):b("div",{className:"company-management-company-credit-grid",children:[e(R,{variant:"secondary",className:"company-management-company-credit-outstanding-balance",children:b("p",{children:[i.outstandingBalance,e("br",{}),e(E,{size:"large",amount:((u=a.credit.outstanding_balance)==null?void 0:u.value)??0,currency:((f=a.credit.outstanding_balance)==null?void 0:f.currency)??"",className:(((T=a.credit.outstanding_balance)==null?void 0:T.value)??0)<0?"company-management-company-credit-negative":void 0})]})}),e(R,{variant:"secondary",className:"company-management-company-credit-available-credit",children:b("p",{children:[i.creditAvailable,e("br",{}),e(E,{size:"large",amount:((L=a.credit.available_credit)==null?void 0:L.value)??0,currency:((v=a.credit.available_credit)==null?void 0:v.currency)??"",className:(((I=a.credit.available_credit)==null?void 0:I.value)??0)<0?"company-management-company-credit-negative":void 0})]})}),e(R,{variant:"secondary",className:"company-management-company-credit-credit-limit",children:b("p",{children:[i.creditLimit,e("br",{}),e(E,{size:"large",amount:((B=a.credit.credit_limit)==null?void 0:B.value)??0,currency:((t=a.credit.credit_limit)==null?void 0:t.currency)??"",className:(((C=a.credit.credit_limit)==null?void 0:C.value)??0)<0?".company-management-company-credit-grid .company-management-company-credit-negative":void 0})]})})]})})},Y=[{text:"10",value:"10"},{text:"20",value:"20"},{text:"50",value:"50"},{text:"100",value:"100"}],$=10,aa=r=>r.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),ea=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),ta=({className:r,initialParams:o={},...i})=>{const a=O({emptyTitle:"Company.CompanyCreditHistory.emptyState.title",emptyMessage:"Company.CompanyCreditHistory.emptyState.message",dateColumn:"Company.CompanyCreditHistory.columns.date",operationColumn:"Company.CompanyCreditHistory.columns.operation",amountColumn:"Company.CompanyCreditHistory.columns.amount",outstandingBalanceColumn:"Company.CompanyCreditHistory.columns.outstandingBalance",availableCreditColumn:"Company.CompanyCreditHistory.columns.availableCredit",creditLimitColumn:"Company.CompanyCreditHistory.columns.creditLimit",customReferenceColumn:"Company.CompanyCreditHistory.columns.customReference",updatedByColumn:"Company.CompanyCreditHistory.columns.updatedBy",itemsRangeText:"Company.CompanyCreditHistory.pagination.itemsRange",showLabel:"Company.CompanyCreditHistory.pagination.show",ariaDataLoaded:"Company.CompanyCreditHistory.ariaLabels.dataLoaded",ariaDataError:"Company.CompanyCreditHistory.ariaLabels.dataError",ariaHistoryTable:"Company.CompanyCreditHistory.ariaLabels.historyTable",ariaPaginationNav:"Company.CompanyCreditHistory.ariaLabels.paginationNav",ariaPageSizeSelector:"Company.CompanyCreditHistory.ariaLabels.pageSizeSelector",ariaShowingHistory:"Company.CompanyCreditHistory.ariaLabels.showingHistory"}),{items:l,loading:d,currentPage:n,pageSize:s,totalItems:y,totalPages:N,announcement:S,handlePageSizeChange:p,handlePageChange:u,refreshCreditHistory:f}=V({initialParams:o,translations:{ariaDataLoaded:a.ariaDataLoaded,ariaDataError:a.ariaDataError}}),T=y===0?0:(n-1)*s+1,L=Math.min(n*s,y);w(()=>{const t=()=>{f()},C=F.on("companyContext/changed",t,{eager:!0});return()=>{var g;(g=C==null?void 0:C.off)==null||g.call(C)}},[f]);const v=x(()=>[{key:"date",label:a.dateColumn},{key:"operation",label:a.operationColumn},{key:"amount",label:a.amountColumn},{key:"outstandingBalance",label:a.outstandingBalanceColumn},{key:"availableCredit",label:a.availableCreditColumn},{key:"creditLimit",label:a.creditLimitColumn},{key:"customReference",label:a.customReferenceColumn},{key:"updatedBy",label:a.updatedByColumn}],[a.dateColumn,a.operationColumn,a.amountColumn,a.outstandingBalanceColumn,a.availableCreditColumn,a.creditLimitColumn,a.customReferenceColumn,a.updatedByColumn]),I=x(()=>l.map(t=>({date:ea(t.date),operation:aa(t.type),amount:t.amount.value===0?"":e(E,{amount:t.amount.value,currency:t.amount.currency,className:"company-management-credit-history-price"}),outstandingBalance:e(E,{amount:t.balance.outstandingBalance.value,currency:t.balance.outstandingBalance.currency,className:"company-management-credit-history-price"}),availableCredit:e(E,{amount:t.balance.availableCredit.value,currency:t.balance.availableCredit.currency,className:"company-management-credit-history-price"}),creditLimit:e(E,{amount:t.balance.creditLimit.value,currency:t.balance.creditLimit.currency,className:"company-management-credit-history-price"}),customReference:t.customReferenceNumber||"",updatedBy:t.updatedBy.name})),[l]);return!d&&l.length===0?b("section",{...i,className:A(["company-management-company-credit-history-display",r]),children:[e("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:S}),e("div",{className:"company-management-credit-history-empty",children:e(z,{heading:a.emptyTitle||"No Credit History",message:e("p",{children:a.emptyMessage||"There is no credit history to display."})})})]}):b("section",{...i,className:A(["company-management-company-credit-history-display",r]),children:[e("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:S}),e("div",{"aria-busy":d,children:e(j,{className:"company-management-company-credit-history-table",columns:v,rowData:I,mobileLayout:"stacked",loading:d,skeletonRowCount:$,"aria-label":a.ariaHistoryTable,summary:a.ariaShowingHistory.replace("{count}",l.length.toString()),tabIndex:0})}),!d&&b("nav",{"aria-label":a.ariaPaginationNav,className:"table-footer",children:[e("div",{className:"table-footer-left",children:e("span",{className:"item-count","aria-live":"polite","aria-atomic":"true",children:(a.itemsRangeText||"Items {start}-{end} of {total}").replace("{start}",T.toString()).replace("{end}",L.toString()).replace("{total}",y.toString())})}),N>1&&e("div",{className:"table-footer-center",children:e(G,{currentPage:n,totalPages:N,onChange:u})}),e("div",{className:"table-footer-right",children:b("div",{className:"pagination-controls",children:[e("span",{className:"pagination-label",children:a.showLabel||"Show"}),d?e("div",{className:"page-size-loading",children:e(Z,{size:"small"})}):e(K,{value:s.toString(),onChange:p,options:Y,className:"page-size-picker","aria-label":a.ariaPageSizeSelector||"Items per page"})]})})]})]})},ua=({creditHistoryParams:r={},showCreditHistory:o=!0,className:i,children:a,...l})=>b("section",{...l,className:i,children:[e(X,{}),o&&e(ta,{initialParams:r}),a]});export{ua as CompanyCredit,ua as default};
//# sourceMappingURL=CompanyCredit.js.map
