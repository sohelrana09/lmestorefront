/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as P,jsx as e,Fragment as pe}from"@dropins/tools/preact-jsx-runtime.js";import{useState as T,useEffect as W,useRef as ie,useCallback as B}from"@dropins/tools/preact-hooks.js";import{Slot as Te,classes as ve}from"@dropins/tools/lib.js";import{Card as Q,InLineAlert as oe,ProgressSpinner as ue,Field as ye,Input as fe,Button as F,Modal as Ce,Header as Ee}from"@dropins/tools/components.js";import{f as he}from"../chunks/fetchUserPermissions.js";import{b as ge}from"../chunks/company-permissions.js";import{useText as X}from"@dropins/tools/i18n.js";import{u as we}from"../chunks/useCompanyContextListener.js";import{a as Ne,i as Me}from"../chunks/isCompanyUser.js";import*as Se from"@dropins/tools/preact-compat.js";import{memo as be}from"@dropins/tools/preact-compat.js";import{T as xe}from"../chunks/Tree.js";import{C as Ue}from"../chunks/CompanyUserForm.js";import{events as se}from"@dropins/tools/event-bus.js";import{p as le,E as de}from"../chunks/acdl.js";import{g as _e,c as De,u as ke,a as Ae,b as Le,d as Pe}from"../chunks/updateCompanyTeam.js";import{d as Fe}from"../chunks/updateCompanyUser.js";import{u as Re}from"../chunks/useInLineAlert.js";import{C as Ve,a as Oe}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/isCompanyRoleNameAvailable.js";const ze=d=>Se.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...d},Se.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),ce={name:40,description:1e3};function Be(d){const{mode:M,entityId:p,parentStructureId:m,onSaved:t,onError:S,onSuccess:i}=d,a=X({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",teamNameMaxLength:"Company.CompanyStructure.shared.validation.teamNameMaxLength",teamDescriptionMaxLength:"Company.CompanyStructure.shared.validation.teamDescriptionMaxLength",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError",createTeamSuccess:"Company.CompanyStructure.messages.createTeamSuccess",updateTeamSuccess:"Company.CompanyStructure.messages.updateTeamSuccess"}),[u,o]=T({id:"",name:"",description:""}),[f,h]=T({}),[g,L]=T({}),[E,U]=T(!1),[V,R]=T(null);W(()=>{M!=="edit"||!p||(U(!0),_e(p).then(C=>{C&&o({id:C.id,name:C.name||"",description:C.description||""})}).finally(()=>U(!1)))},[M,p]);const O=(C,v)=>C==="name"?v.trim()?v.length>ce.name?a.teamNameMaxLength:null:a.teamTitleRequired:C==="description"&&v&&v.length>ce.description?a.teamDescriptionMaxLength:null,_=(C,v)=>{o(D=>({...D,[C]:v})),V&&R(null)};return{values:u,errors:f,touched:g,loading:E,setValue:_,onBlur:(C,v)=>{v!==void 0&&_(C,v),L(k=>({...k,[C]:!0}));const D=v!==void 0?v:u[C]||"",N=O(C,D);h(N?k=>({...k,[C]:N}):k=>{const x={...k};return delete x[C],x})},submit:async()=>{const C=O("name",u.name),v=O("description",u.description||""),D={},N={name:!0,description:!0};if(C&&(D.name=C),v&&(D.description=v),L(N),Object.keys(D).length>0){h(D);return}const k=u.name;try{if(M==="add"){const x=await De({name:u.name,description:u.description||null,targetId:m??null});if(!x){const Y=a.createTeamError;S?S(Y):R(Y);return}t({label:k,structureId:x.structureId,entityId:x.id,type:"team",description:u.description||void 0}),i&&i(a.createTeamSuccess)}else p&&(await ke({id:p,name:u.name,description:u.description||null}),t({label:k,entityId:p,type:"team",description:u.description||void 0}),i&&i(a.updateTeamSuccess))}catch(x){const Y=x instanceof Error?x.message:a.saveTeamError;S?S(Y):R(Y)}},generalError:V}}const He=be(({mode:d,entityId:M,parentStructureId:p,permissions:m,onSaved:t,onCancel:S,onError:i,onSuccess:a})=>{const u=(m==null?void 0:m.canEditUsers)??!1,{values:o,errors:f,touched:h,loading:g,onBlur:L,submit:E,generalError:U}=Be({mode:d,entityId:M,parentStructureId:p,onSaved:t,onError:i?_=>{i(_),S()}:void 0,onSuccess:a}),[V,R]=T(!1),O=X({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return P("div",{children:[e("h3",{className:"acm-structure-panel__title",children:d==="add"?O.addTeam:O.editTeam}),P(Q,{variant:"secondary",className:`company-team-form__card ${V?"is-working":""}`,children:[!i&&U?e(oe,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:U}):null,V?e("div",{className:"company-team-form__overlay","aria-live":"polite",children:e(ue,{size:"small"})}):null,g?e(Ve,{}):P("div",{className:"company-team-form__content",children:[e(ye,{label:O.teamTitle,required:!0,className:"acm-structure-panel__field",error:h.name&&f.name?f.name:void 0,children:e(fe,{name:"team_title",type:"text",value:o.name,onBlur:_=>{const j=_.target;L("name",j.value)},variant:"primary",size:"medium",disabled:!u,maxLength:ce.name})}),e(ye,{label:O.description,className:"acm-structure-panel__field",error:h.description&&f.description?f.description:void 0,children:e(fe,{name:"team_description",type:"textarea",value:o.description||"",onBlur:_=>{const j=_.target;L("description",j.value)},variant:"primary",size:"medium",disabled:!u,maxLength:ce.description})})]})]}),g?null:P("div",{className:"acm-structure-modal__actions",children:[e(F,{type:"button",variant:"primary",onClick:async()=>{if(!V){R(!0);try{await E()}finally{R(!1)}}},disabled:V||!u,children:"Save"}),e(F,{type:"button",variant:"secondary",disabled:V,onClick:S,children:"Cancel"})]})]})});function $e({handleSetInLineAlert:d,permissions:M}={permissions:null}){const p=(M==null?void 0:M.canViewUsers)??!1,m=X({loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem",removeUserSuccess:"Company.CompanyStructure.messages.removeUserSuccess",deleteTeamSuccess:"Company.CompanyStructure.messages.deleteTeamSuccess",removeMultipleSuccess:"Company.CompanyStructure.messages.removeMultipleSuccess",moveUserSuccess:"Company.CompanyStructure.messages.moveUserSuccess",moveTeamSuccess:"Company.CompanyStructure.messages.moveTeamSuccess"}),{loadError:t,updateError:S}=m,[i,a]=T(null),[u,o]=T(!0),[f,h]=T(!1),[g,L]=T(!1),[E,U]=T(new Set),[V,R]=T(null),[O,_]=T(new Set),[j,J]=T({}),C=ie(d),v=ie(!1),D=ie(!1);W(()=>{C.current=d},[d]);const N=B((n,l)=>{d&&(n==="success"?d({type:"success",text:l}):n==="error"?d({type:"error",text:l}):d(),h(!1))},[d]),k=B(async()=>{if(v.current)return null;if(v.current=!0,!p)return o(!1),a(null),U(new Set),R(null),_(new Set),v.current=!1,null;o(!0);try{const l=await Ae();return a(l),U(new Set(l.map(A=>A.id))),o(!1),l}catch{return o(!1),C.current&&C.current({type:"error",text:t}),null}finally{v.current=!1}},[p,t]);W(()=>{p&&!D.current&&(D.current=!0,k())},[p,k]),W(()=>{const n=()=>{o(!0),U(new Set),R(null),_(new Set),k()},l=se.on("companyContext/changed",n,{eager:!0});return()=>{l==null||l.off()}},[k]);const x=B(async(n,l)=>{try{if(h(!0),!await Le({id:n,parentId:l}))return N("error",m.failedToMoveItem),!1;const I=new Map(i==null?void 0:i.map(r=>[r.id,r])).get(n),z=(I==null?void 0:I.type)==="team"?m.moveTeamSuccess:m.moveUserSuccess;return a(r=>r?r.map(c=>c.id===n?{...c,parentId:l}:c):null),U(r=>new Set([...r,l])),le(de.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:n,newParentId:l}),se.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:n,newParentId:l,nodes:i||[]}),N("success",z),!0}catch(A){const H=A instanceof Error?A.message:S;return N("error",H),!1}finally{h(!1)}},[i,N,S,m.failedToMoveItem,m.moveUserSuccess,m.moveTeamSuccess]),Y=B(()=>{i&&U(new Set(i.map(n=>n.id)))},[i]),q=B(()=>{if(i){const n=i.filter(l=>l.parentId===null).map(l=>l.id);U(new Set(n))}},[i]),Z=B(n=>{a(l=>{const A=l?[...l,{id:n.id,parentId:n.parentId,label:n.label,type:n.type,entityId:n.entityId,description:n.description}]:[{id:n.id,parentId:n.parentId,label:n.label,type:n.type,entityId:n.entityId,description:n.description}];return se.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:n.id,newParentId:n.parentId||void 0,nodes:A}),le(de.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:n.id,newParentId:n.parentId||void 0,nodeType:n.type}),A}),n.parentId&&U(l=>new Set([...l,n.parentId]))},[]),ee=B((n,l,A)=>{l&&a(H=>H?H.map(I=>n.includes(I.id)?{...I,label:l,description:A}:I):null)},[]),te=B(async n=>{if(n.length)try{h(!0);const l=new Map((i||[]).map(I=>[I.id,I])),A=n.map(I=>l.get(I)).filter(Boolean);for(const I of n){const z=l.get(I);!z||!z.entityId||(z.type==="team"?await Pe(z.entityId):await Fe({id:z.entityId}))}a(I=>{if(!I)return null;const z=new Set(n);return I.filter(r=>!z.has(r.id))}),R(null),_(new Set),le(de.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:n}),se.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:n,nodes:i||[]});let H;if(n.length===1){const I=A[0];H=(I==null?void 0:I.type)==="team"?m.deleteTeamSuccess:m.removeUserSuccess}else H=m.removeMultipleSuccess.replace("{count}",n.length.toString());N("success",H)}catch(l){const A=l instanceof Error?l.message:S;N("error",A)}finally{h(!1)}},[i,N,S,m.removeUserSuccess,m.deleteTeamSuccess,m.removeMultipleSuccess]),re=B(n=>{J(n)},[]),K=B(()=>{L(!0),N("success",""),J({})},[N]),ae=B(n=>{n==null||n(),L(!1),J({})},[]);return{nodes:i,loading:u,submitLoading:f,showEditForm:g,inputChange:j,expanded:E,setExpanded:U,selected:V,setSelected:R,selectedMany:O,setSelectedMany:_,move:x,expandAll:Y,collapseAll:q,insertNode:Z,renameNodes:ee,removeNodes:te,handleInputChange:re,handleShowEditForm:K,handleHideEditForm:ae,renderAlertMessage:N,working:f}}const je=be(({permissions:d,slots:M})=>{var z;const p=(d==null?void 0:d.canEditUsers)??!1,m=(d==null?void 0:d.canViewUsers)??!1,t=X({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:S,handleSetInLineAlert:i}=Re(),{nodes:a,loading:u,submitLoading:o,expanded:f,setExpanded:h,selected:g,setSelected:L,selectedMany:E,setSelectedMany:U,move:V,expandAll:R,collapseAll:O,insertNode:_,renameNodes:j,removeNodes:J}=$e({handleSetInLineAlert:i,permissions:d}),[C,v]=T(null),[D,N]=T("add"),[k,x]=T(!1),[Y,q]=T([]),[Z,ee]=T({title:"",body:"",confirmLabel:t.remove,blocked:!1}),[te,re]=T(null),K=()=>v(null),ae=((z=a==null?void 0:a.find(r=>r.parentId===null))==null?void 0:z.id)??null,n=(a||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label})),l=r=>{if(!a)return 0;let c=0;const y=[r],s=new Set;for(;y.length>0;){const w=y.pop();if(!w||s.has(w))continue;s.add(w);const b=a.filter($=>$.parentId===w);c+=b.length,b.forEach($=>y.push($.id))}return c},A=(r,c)=>{let y=r;const s=new Map(n.map(b=>[b.id,b])),w=new Set;for(;y&&!w.has(y);){w.add(y);const b=s.get(y);if(!b)break;if(b.parentId===c)return!0;y=b.parentId??null}return!1},H=(a||[]).map(r=>({id:r.id,parentId:r.parentId,label:r.label,type:r.type,description:r.description,entityId:r.entityId})),I=P(pe,{children:[(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=p&&r.length===1,y=p&&r.length>=1;return e(Q,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:P("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":t.companyStructureActions,children:[e(F,{type:"button",variant:"secondary",onClick:R,"aria-label":t.expandAllNodes,disabled:!m,"aria-disabled":!m,children:t.expandAll}),e(F,{type:"button",variant:"secondary",onClick:O,"aria-label":t.collapseAllNodes,disabled:!m,"aria-disabled":!m,children:t.collapseAll}),e(F,{type:"button",variant:"primary",onClick:()=>{N("add"),v("user")},"aria-label":t.addUserAria,disabled:!p,"aria-disabled":!p,children:t.addUser}),e(F,{type:"button",variant:"primary",onClick:()=>{N("add"),v("team")},"aria-label":t.addTeamAria,disabled:!p,"aria-disabled":!p,children:t.addTeam}),e(F,{type:"button",variant:"primary",disabled:!c,"aria-disabled":!c,"aria-label":t.editSelectedAria,onClick:()=>{if(!c)return;const s=r,w=a==null?void 0:a.find(b=>b.id===s[0]);(w==null?void 0:w.type)==="user"?(N("edit"),v("user")):(N("edit"),v("team"))},children:t.editSelected}),e(F,{type:"button",variant:"secondary",disabled:!y||o,"aria-disabled":!y||o,"aria-label":t.removeSelectedAria,onClick:()=>{if(!y||o)return;const s=r;if(s.length===1){const w=a==null?void 0:a.find($=>$.id===s[0]);if(!w)return;(a==null?void 0:a.some($=>$.parentId===w.id))?(ee({title:w.type==="user"?t.cannotDeleteUser:t.cannotDeleteTeam,body:w.type==="user"?t.cannotDeleteUserMessage:t.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),q([]),x(!0)):(ee({title:w.type==="user"?t.removeUserConfirm:t.deleteTeamConfirm,body:w.type==="user"?t.removeUserMessage:t.deleteTeamMessage,confirmLabel:w.type==="user"?t.remove:t.delete,blocked:!1}),q(s),x(!0))}else ee({title:t.removeItemsConfirm.replace("{count}",s.length.toString()),body:t.removeItemsMessage,confirmLabel:t.remove,blocked:!1}),q(s),x(!0)},children:t.remove})]})})})(),C?P("div",{className:"acm-structure-panel",children:[o?P("div",{className:"acm-structure-working","aria-live":"polite",children:[e(ue,{size:"small"})," ",t.processing]}):null,C==="user"?(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=r.length?a==null?void 0:a.find(s=>s.id===r[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(Ue,{mode:D,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:d,onSaved:s=>{D==="add"?s.structureId&&(_({id:s.structureId,parentId:y,label:s.label,type:s.type,entityId:s.entityId,description:s.jobTitle??void 0}),s.structureId&&(L(s.structureId),U(new Set([s.structureId])))):r.length&&j(r,s.label,s.jobTitle??void 0),K()},onCancel:K,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null,C==="team"?(()=>{const r=E!=null&&E.size?Array.from(E):g?[g]:[],c=r.length?a==null?void 0:a.find(s=>s.id===r[0]):void 0,y=(c==null?void 0:c.id)??ae;return e(He,{mode:D,entityId:c==null?void 0:c.entityId,parentStructureId:y,permissions:d,onSaved:s=>{D==="add"?s.structureId&&(_({id:s.structureId,parentId:y,label:s.label,type:s.type,entityId:s.entityId,description:s.description}),s.structureId&&(L(s.structureId),U(new Set([s.structureId])))):r.length&&j(r,s.label,s.description),K()},onCancel:K,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null]}):null,S&&S.text?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(oe,{className:"acm-structure-panel__notification",type:S.type||"success",variant:"secondary",heading:S.text})}):null,!u&&!o&&a&&a.length===0?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e(oe,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:t.noStructureData})}):null,!u&&o?e("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:e(ue,{size:"medium"})}):null,u?e(Q,{variant:"secondary",className:"acm-structure-message-card",children:e("div",{className:"acm-structure-tree-content",children:e(Oe,{rows:8})})}):null,!u&&a&&a.length>0?e("div",{className:`acm-structure-tree-card ${o?"is-working":""}`,children:e(xe,{rootId:null,items:n,expandedIds:f,selectedId:g,selectedIds:E,onExpandedChange:h,onSelectedChange:L,onSelectedIdsChange:U,renderExpander:({expanded:r,toggle:c})=>e("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${r?"is-open":""}`,"aria-label":r?t.collapse:t.expand,onClick:y=>{y.stopPropagation(),c()},children:e("span",{className:`acm-structure-chevron ${r?"is-expanded":""}`})}),renderNode:({item:r,hasChildren:c,expander:y,icon:s,select:w})=>{const b=a==null?void 0:a.find(G=>G.id===r.id),$=l(r.id),ne=(b==null?void 0:b.description)||"",Ie=(b==null?void 0:b.type)==="team"&&ne,me=(b==null?void 0:b.parentId)===null;return P("div",{className:"acm-structure-row",onClick:w,children:[!me&&e("span",{className:"acm-structure-handle","aria-hidden":!0}),s?e("span",{onClick:G=>G.stopPropagation(),children:s()}):e("span",{className:`acm-structure-icon ${(b==null?void 0:b.type)==="team"?"is-team":"is-user"} ${me?"is-root":""}`,"aria-hidden":!0}),P("div",{className:"acm-structure-info",children:[e("span",{className:"acm-structure-label",children:r.label}),ne?e("span",{className:"acm-structure-description",children:ne}):null]}),Ie?e(F,{type:"button",variant:"secondary",onClick:G=>{G.stopPropagation(),re({id:r.id,text:ne})},"aria-label":t.showDescription,className:"acm-structure-description-button",children:"?"}):null,$>0?e("span",{className:"acm-structure-count",children:$}):null,c&&y?e("span",{className:"acm-structure-expander-wrapper",onClick:G=>G.stopPropagation(),children:y()}):null]})},draggable:r=>{const c=a==null?void 0:a.find(s=>s.id===r.id),y=c?c.parentId===null:!1;return!o&&p&&!y},canDrop:(r,c)=>{if(!p||r===c)return!1;const y=a==null?void 0:a.find(s=>s.id===r);return y&&y.parentId===c?!1:!A(c,r)},onMove:async({id:r,newParentId:c})=>{p&&await V(r,c)}})}):null,k?e(Ce,{open:k,onClose:()=>{o||(x(!1),q([]))},children:P("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:Z.title}),e("div",{children:Z.body}),e("div",{className:"acm-structure-modal-actions",children:Z.blocked?e(F,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(x(!1),q([]))},children:t.ok}):P(pe,{children:[e(F,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(x(!1),q([]))},children:t.cancel}),e(F,{type:"button",variant:"primary",disabled:o,onClick:async()=>{await J(Y),x(!1),q([])},children:o?Z.confirmLabel===t.delete?t.deleting:t.removing:Z.confirmLabel||t.remove})]})})]})}):null,te?e(Ce,{open:!!te,onClose:()=>re(null),children:P("div",{className:"acm-structure-modal-content",children:[e("h3",{className:"acm-structure-modal-title",children:t.teamDescription}),e("div",{children:te.text}),e("div",{className:"acm-structure-modal-actions",children:e(F,{type:"button",variant:"secondary",onClick:()=>re(null),children:t.close})})]})}):null]});return M!=null&&M.StructureData?e(Te,{name:"StructureData",slot:M.StructureData,context:{structureData:H,Default:I}}):I}),Ye=()=>{const d=X({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[M,p]=T(null),[m,t]=T(!0),[S,i]=T(null),a=B(async()=>{var u,o;try{t(!0),i(null);const{roleResponse:f}=await he(),h=(o=(u=f==null?void 0:f.data)==null?void 0:u.customer)==null?void 0:o.role,g=ge(h);p(g)}catch(f){i(f instanceof Error?f:new Error(d.fetchPermissionsError))}finally{t(!1)}},[d.fetchPermissionsError]);return W(()=>{let u=!0;return(async()=>{var f,h;try{t(!0),i(null);const{roleResponse:g}=await he();if(!u)return;const L=(h=(f=g==null?void 0:g.data)==null?void 0:f.customer)==null?void 0:h.role,E=ge(L);p(E)}catch(g){if(!u)return;i(g instanceof Error?g:new Error(d.fetchPermissionsError))}finally{u&&t(!1)}})(),()=>{u=!1}},[]),{permissions:M,loading:m,error:S,refreshPermissions:a}},qe="/customer/company/create",Ze=({className:d,children:M,createCompanyAccountUrl:p=qe,...m})=>{const t=X({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),S=t.individualUserMessage||"You don't have a company account yet.";return e(Q,{variant:"secondary",className:ve(["company-management-company-structure-card",d]),...m,children:P("div",{children:[e(oe,{type:"warning",variant:"secondary",heading:S,icon:e(ze,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),e("div",{className:"company-management-company-structure-card__cta",children:e(F,{as:"a",href:p,variant:"primary","data-testid":"company-structure-create-company-button",children:t.createAccountCta||"Create a Company Account"})})]})})},ht=({className:d,withHeader:M=!1,slots:p,isAuthenticated:m=!1,onRedirectLogin:t,onRedirectAccount:S})=>{const i=X({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:a,refreshPermissions:u}=Ye(),[o,f]=T("loading");return we(u),W(()=>{let h=!0;return(async()=>{try{if(!m){h&&f("redirect-login");return}if(!await Ne()){h&&(console.log("Company registration disabled - redirecting to account dashboard"),f("redirect-account"));return}await Me()?h&&f("show-structure"):h&&f("show-empty")}catch(g){console.error("Error in CompanyStructure - redirecting to login page:",g),h&&f("redirect-login")}})(),()=>{h=!1}},[m]),W(()=>{o==="redirect-login"&&t&&t(),o==="redirect-account"&&S&&S()},[o,t,S]),o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="show-empty"?e(Ze,{className:d}):o==="show-structure"?P("div",{className:ve(["account-company-structure",d]),children:[M?e(Ee,{title:i.containerTitle,divider:!1,className:"company-structure__title"}):null,e(je,{slots:p,permissions:a})]}):null};export{ht as CompanyStructure,ht as default};
//# sourceMappingURL=CompanyStructure.js.map
