/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsxs as L,jsx as t,Fragment as me}from"@dropins/tools/preact-jsx-runtime.js";import{useState as I,useEffect as G,useRef as ce,useCallback as H}from"@dropins/tools/preact-hooks.js";import{Slot as be,classes as Se}from"@dropins/tools/lib.js";import{Card as ae,InLineAlert as ne,ProgressSpinner as ue,Field as pe,Input as ye,Button as P,Modal as fe,Header as Ie}from"@dropins/tools/components.js";import{f as Ce}from"../chunks/fetchUserPermissions.js";import{b as ge}from"../chunks/company-permissions.js";import{useText as W}from"@dropins/tools/i18n.js";import{u as Te}from"../chunks/useCompanyContextListener.js";import{a as Ee,i as we}from"../chunks/isCompanyUser.js";import*as he from"@dropins/tools/preact-compat.js";import{memo as ve}from"@dropins/tools/preact-compat.js";import{T as Ne}from"../chunks/Tree.js";import{C as Me}from"../chunks/CompanyUserForm.js";import{events as re}from"@dropins/tools/event-bus.js";import{p as ie,E as le}from"../chunks/acdl.js";import{g as xe,c as Ue,u as _e,a as De,b as Ae,d as ke}from"../chunks/updateCompanyTeam.js";import{u as Le}from"../chunks/updateCompanyUserStatus.js";import{u as Pe}from"../chunks/useInLineAlert.js";import{C as Fe,a as Ve}from"../chunks/CompanyLoaders.js";import"../chunks/fetch-error.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/useCompanyRoles.js";import"../chunks/isCompanyRoleNameAvailable.js";const Re=u=>he.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...u},he.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),se={name:40,description:1e3};function Oe(u){const{mode:w,entityId:p,parentStructureId:d,onSaved:e,onError:S,onSuccess:i}=u,n=W({teamTitleRequired:"Company.CompanyStructure.shared.validation.teamTitleRequired",teamNameMaxLength:"Company.CompanyStructure.shared.validation.teamNameMaxLength",teamDescriptionMaxLength:"Company.CompanyStructure.shared.validation.teamDescriptionMaxLength",createTeamError:"Company.CompanyStructure.messages.createTeamError",saveTeamError:"Company.CompanyStructure.messages.saveTeamError",createTeamSuccess:"Company.CompanyStructure.messages.createTeamSuccess",updateTeamSuccess:"Company.CompanyStructure.messages.updateTeamSuccess"}),[m,o]=I({id:"",name:"",description:""}),[y,C]=I({}),[g,k]=I({}),[T,M]=I(!1),[V,F]=I(null);G(()=>{w!=="edit"||!p||(M(!0),xe(p).then(f=>{f&&o({id:f.id,name:f.name||"",description:f.description||""})}).finally(()=>M(!1)))},[w,p]);const R=(f,v)=>f==="name"?v.trim()?v.length>se.name?n.teamNameMaxLength:null:n.teamTitleRequired:f==="description"&&v&&v.length>se.description?n.teamDescriptionMaxLength:null,U=(f,v)=>{o(_=>({..._,[f]:v})),V&&F(null)};return{values:m,errors:y,touched:g,loading:T,setValue:U,onBlur:(f,v)=>{v!==void 0&&U(f,v),k(D=>({...D,[f]:!0}));const _=v!==void 0?v:m[f]||"",E=R(f,_);C(E?D=>({...D,[f]:E}):D=>{const N={...D};return delete N[f],N})},submit:async()=>{const f=R("name",m.name),v=R("description",m.description||""),_={},E={name:!0,description:!0};if(f&&(_.name=f),v&&(_.description=v),k(E),Object.keys(_).length>0){C(_);return}const D=m.name;try{if(w==="add"){const N=await Ue({name:m.name,description:m.description||null,targetId:d??null});if(!N){const q=n.createTeamError;S?S(q):F(q);return}e({label:D,structureId:N.structureId,entityId:N.id,type:"team",description:m.description||void 0}),i&&i(n.createTeamSuccess)}else p&&(await _e({id:p,name:m.name,description:m.description||null}),e({label:D,entityId:p,type:"team",description:m.description||void 0}),i&&i(n.updateTeamSuccess))}catch(N){const q=N instanceof Error?N.message:n.saveTeamError;S?S(q):F(q)}},generalError:V}}const ze=ve(({mode:u,entityId:w,parentStructureId:p,permissions:d,onSaved:e,onCancel:S,onError:i,onSuccess:n})=>{const m=(d==null?void 0:d.canEditUsers)??!1,{values:o,errors:y,touched:C,loading:g,onBlur:k,submit:T,generalError:M}=Oe({mode:u,entityId:w,parentStructureId:p,onSaved:e,onError:i?U=>{i(U),S()}:void 0,onSuccess:n}),[V,F]=I(!1),R=W({addTeam:"Company.CompanyStructure.shared.titles.addTeam",editTeam:"Company.CompanyStructure.shared.titles.editTeam",teamTitle:"Company.CompanyStructure.shared.fields.teamTitle",description:"Company.CompanyStructure.shared.fields.description"});return L("div",{children:[t("h3",{className:"acm-structure-panel__title",children:u==="add"?R.addTeam:R.editTeam}),L(ae,{variant:"secondary",className:`company-team-form__card ${V?"is-working":""}`,children:[!i&&M?t(ne,{className:"company-team-form__notification",type:"error",variant:"secondary",heading:M}):null,V?t("div",{className:"company-team-form__overlay","aria-live":"polite",children:t(ue,{size:"small"})}):null,g?t(Fe,{}):L("div",{className:"company-team-form__content",children:[t(pe,{label:R.teamTitle,required:!0,className:"acm-structure-panel__field",error:C.name&&y.name?y.name:void 0,children:t(ye,{name:"team_title",type:"text",value:o.name,onBlur:U=>{const Y=U.target;k("name",Y.value)},variant:"primary",size:"medium",disabled:!m,maxLength:se.name})}),t(pe,{label:R.description,className:"acm-structure-panel__field",error:C.description&&y.description?y.description:void 0,children:t(ye,{name:"team_description",type:"textarea",value:o.description||"",onBlur:U=>{const Y=U.target;k("description",Y.value)},variant:"primary",size:"medium",disabled:!m,maxLength:se.description})})]})]}),g?null:L("div",{className:"acm-structure-modal__actions",children:[t(P,{type:"button",variant:"primary",onClick:async()=>{if(!V){F(!0);try{await T()}finally{F(!1)}}},disabled:V||!m,children:"Save"}),t(P,{type:"button",variant:"secondary",disabled:V,onClick:S,children:"Cancel"})]})]})});function Be({handleSetInLineAlert:u,permissions:w}={permissions:null}){const p=(w==null?void 0:w.canViewUsers)??!1,d=W({loadError:"Company.CompanyStructure.messages.loadError",updateError:"Company.CompanyStructure.messages.updateError",failedToMoveItem:"Company.CompanyStructure.messages.failedToMoveItem",removeUserSuccess:"Company.CompanyStructure.messages.removeUserSuccess",deleteTeamSuccess:"Company.CompanyStructure.messages.deleteTeamSuccess",removeMultipleSuccess:"Company.CompanyStructure.messages.removeMultipleSuccess",moveUserSuccess:"Company.CompanyStructure.messages.moveUserSuccess",moveTeamSuccess:"Company.CompanyStructure.messages.moveTeamSuccess"}),{loadError:e,updateError:S}=d,[i,n]=I(null),[m,o]=I(!0),[y,C]=I(!1),[g,k]=I(!1),[T,M]=I(new Set),[V,F]=I(null),[R,U]=I(new Set),[Y,j]=I({}),f=ce(u),v=ce(!1),_=ce(!1);G(()=>{f.current=u},[u]);const E=H((r,l)=>{u&&(r==="success"?u({type:"success",text:l}):r==="error"?u({type:"error",text:l}):u(),C(!1))},[u]),D=H(async()=>{if(v.current)return null;if(v.current=!0,!p)return o(!1),n(null),M(new Set),F(null),U(new Set),v.current=!1,null;o(!0);try{const l=await De();return n(l),M(new Set(l.map(A=>A.id))),o(!1),l}catch{return o(!1),f.current&&f.current({type:"error",text:e}),null}finally{v.current=!1}},[p,e]);G(()=>{p&&!_.current&&(_.current=!0,D())},[p,D]),G(()=>{const r=()=>{o(!0),M(new Set),F(null),U(new Set),D()},l=re.on("companyContext/changed",r,{eager:!0});return()=>{l==null||l.off()}},[D]);const N=H(async(r,l)=>{try{if(C(!0),!await Ae({id:r,parentId:l}))return E("error",d.failedToMoveItem),!1;const b=new Map(i==null?void 0:i.map(c=>[c.id,c])).get(r),a=(b==null?void 0:b.type)==="team"?d.moveTeamSuccess:d.moveUserSuccess;return n(c=>c?c.map(h=>h.id===r?{...h,parentId:l}:h):null),M(c=>new Set([...c,l])),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"move",nodeId:r,newParentId:l}),re.emit("companyStructure/updated",{message:"Structure updated",action:"move",nodeId:r,newParentId:l,nodes:i||[]}),E("success",a),!0}catch(A){const O=A instanceof Error?A.message:S;return E("error",O),!1}finally{C(!1)}},[i,E,S,d.failedToMoveItem,d.moveUserSuccess,d.moveTeamSuccess]),q=H(()=>{i&&M(new Set(i.map(r=>r.id)))},[i]),$=H(()=>{if(i){const r=i.filter(l=>l.parentId===null).map(l=>l.id);M(new Set(r))}},[i]),Z=H(r=>{n(l=>{const A=l?[...l,{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}]:[{id:r.id,parentId:r.parentId,label:r.label,type:r.type,entityId:r.entityId,description:r.description}];return re.emit("companyStructure/updated",{message:"Structure updated",action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodes:A}),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"add",nodeId:r.id,newParentId:r.parentId||void 0,nodeType:r.type}),A}),r.parentId&&M(l=>new Set([...l,r.parentId]))},[]),K=H((r,l,A)=>{l&&n(O=>O?O.map(b=>r.includes(b.id)?{...b,label:l,description:A}:b):null)},[]),Q=H(async r=>{if(r.length)try{C(!0);const l=new Map((i||[]).map(b=>[b.id,b])),A=r.map(b=>l.get(b)).filter(Boolean);for(const b of r){const a=l.get(b);!a||!a.entityId||(a.type==="team"?await ke(a.entityId):await Le({id:a.entityId,status:"INACTIVE"}))}n(b=>{if(!b)return null;const a=new Set(r);return b.filter(c=>!a.has(c.id))}),F(null),U(new Set),ie(le.EDIT_COMPANY_STRUCTURE_EVENT,{action:"remove",nodeIds:r}),re.emit("companyStructure/updated",{message:"Structure updated",action:"remove",nodeIds:r,nodes:i||[]});let O;if(r.length===1){const b=A[0];O=(b==null?void 0:b.type)==="team"?d.deleteTeamSuccess:d.removeUserSuccess}else O=d.removeMultipleSuccess.replace("{count}",r.length.toString());E("success",O)}catch(l){const A=l instanceof Error?l.message:S;E("error",A)}finally{C(!1)}},[i,E,S,d.removeUserSuccess,d.deleteTeamSuccess,d.removeMultipleSuccess]),ee=H(r=>{j(r)},[]),X=H(()=>{k(!0),E("success",""),j({})},[E]),te=H(r=>{r==null||r(),k(!1),j({})},[]);return{nodes:i,loading:m,submitLoading:y,showEditForm:g,inputChange:Y,expanded:T,setExpanded:M,selected:V,setSelected:F,selectedMany:R,setSelectedMany:U,move:N,expandAll:q,collapseAll:$,insertNode:Z,renameNodes:K,removeNodes:Q,handleInputChange:ee,handleShowEditForm:X,handleHideEditForm:te,renderAlertMessage:E,working:y}}const He=ve(({permissions:u,slots:w})=>{var b;const p=(u==null?void 0:u.canEditUsers)??!1,d=(u==null?void 0:u.canViewUsers)??!1,e=W({expandAll:"Company.CompanyStructure.shared.buttons.expandAll",collapseAll:"Company.CompanyStructure.shared.buttons.collapseAll",addUser:"Company.CompanyStructure.shared.buttons.addUser",addTeam:"Company.CompanyStructure.shared.buttons.addTeam",editSelected:"Company.CompanyStructure.shared.buttons.editSelected",remove:"Company.CompanyStructure.shared.buttons.remove",ok:"Company.CompanyStructure.shared.buttons.ok",cancel:"Company.CompanyStructure.shared.buttons.cancel",close:"Company.CompanyStructure.shared.buttons.close",deleting:"Company.CompanyStructure.shared.buttons.deleting",removing:"Company.CompanyStructure.shared.buttons.removing",noStructureData:"Company.CompanyStructure.messages.noStructureData",processing:"Company.CompanyStructure.shared.messages.processing",cannotDeleteUser:"Company.CompanyStructure.messages.cannotDeleteUser",cannotDeleteTeam:"Company.CompanyStructure.messages.cannotDeleteTeam",removeUserConfirm:"Company.CompanyStructure.messages.removeUserConfirm",deleteTeamConfirm:"Company.CompanyStructure.messages.deleteTeamConfirm",removeItemsConfirm:"Company.CompanyStructure.messages.removeItemsConfirm",teamDescription:"Company.CompanyStructure.shared.messages.teamDescription",removeUserMessage:"Company.CompanyStructure.messages.removeUserMessage",cannotDeleteUserMessage:"Company.CompanyStructure.messages.cannotDeleteUserMessage",cannotDeleteTeamMessage:"Company.CompanyStructure.messages.cannotDeleteTeamMessage",removeItemsMessage:"Company.CompanyStructure.messages.removeItemsMessage",companyStructureActions:"Company.CompanyStructure.shared.ariaLabels.companyStructureActions",expandAllNodes:"Company.CompanyStructure.shared.ariaLabels.expandAllNodes",collapseAllNodes:"Company.CompanyStructure.shared.ariaLabels.collapseAllNodes",addUserAria:"Company.CompanyStructure.shared.ariaLabels.addUser",addTeamAria:"Company.CompanyStructure.shared.ariaLabels.addTeam",editSelectedAria:"Company.CompanyStructure.shared.ariaLabels.editSelected",removeSelectedAria:"Company.CompanyStructure.shared.ariaLabels.removeSelected",showDescription:"Company.CompanyStructure.shared.ariaLabels.showDescription",delete:"Company.CompanyStructure.shared.options.delete",expand:"Company.CompanyStructure.shared.options.expand",collapse:"Company.CompanyStructure.shared.options.collapse",deleteTeamMessage:"Company.CompanyStructure.messages.deleteTeamMessage"}),{inLineAlertProps:S,handleSetInLineAlert:i}=Pe(),{nodes:n,loading:m,submitLoading:o,expanded:y,setExpanded:C,selected:g,setSelected:k,selectedMany:T,setSelectedMany:M,move:V,expandAll:F,collapseAll:R,insertNode:U,renameNodes:Y,removeNodes:j}=Be({handleSetInLineAlert:i,permissions:u}),[f,v]=I(null),[_,E]=I("add"),[D,N]=I(!1),[q,$]=I([]),[Z,K]=I({title:"",body:"",confirmLabel:e.remove,blocked:!1}),[Q,ee]=I(null),X=()=>v(null),te=((b=n==null?void 0:n.find(a=>a.parentId===null))==null?void 0:b.id)??null,r=(n||[]).map(a=>({id:a.id,parentId:a.parentId,label:a.label})),l=(a,c)=>{let h=a;const s=new Map(r.map(z=>[z.id,z])),x=new Set;for(;h&&!x.has(h);){x.add(h);const z=s.get(h);if(!z)break;if(z.parentId===c)return!0;h=z.parentId??null}return!1},A=(n||[]).map(a=>({id:a.id,parentId:a.parentId,label:a.label,type:a.type,description:a.description,entityId:a.entityId})),O=L(me,{children:[(()=>{const a=T!=null&&T.size?Array.from(T):g?[g]:[],c=p&&a.length===1,h=p&&a.length>=1;return t(ae,{variant:"secondary",className:"acm-structure-toolbar-card acm-structure-toolbar-card--spaced",children:L("div",{className:"acm-structure-toolbar",role:"toolbar","aria-label":e.companyStructureActions,children:[t(P,{type:"button",variant:"secondary",onClick:F,"aria-label":e.expandAllNodes,disabled:!d,"aria-disabled":!d,children:e.expandAll}),t(P,{type:"button",variant:"secondary",onClick:R,"aria-label":e.collapseAllNodes,disabled:!d,"aria-disabled":!d,children:e.collapseAll}),t(P,{type:"button",variant:"primary",onClick:()=>{E("add"),v("user")},"aria-label":e.addUserAria,disabled:!p,"aria-disabled":!p,children:e.addUser}),t(P,{type:"button",variant:"primary",onClick:()=>{E("add"),v("team")},"aria-label":e.addTeamAria,disabled:!p,"aria-disabled":!p,children:e.addTeam}),t(P,{type:"button",variant:"primary",disabled:!c,"aria-disabled":!c,"aria-label":e.editSelectedAria,onClick:()=>{if(!c)return;const s=a,x=n==null?void 0:n.find(z=>z.id===s[0]);(x==null?void 0:x.type)==="user"?(E("edit"),v("user")):(E("edit"),v("team"))},children:e.editSelected}),t(P,{type:"button",variant:"secondary",disabled:!h||o,"aria-disabled":!h||o,"aria-label":e.removeSelectedAria,onClick:()=>{if(!h||o)return;const s=a;if(s.length===1){const x=n==null?void 0:n.find(J=>J.id===s[0]);if(!x)return;(n==null?void 0:n.some(J=>J.parentId===x.id))?(K({title:x.type==="user"?e.cannotDeleteUser:e.cannotDeleteTeam,body:x.type==="user"?e.cannotDeleteUserMessage:e.cannotDeleteTeamMessage,confirmLabel:void 0,blocked:!0}),$([]),N(!0)):(K({title:x.type==="user"?e.removeUserConfirm:e.deleteTeamConfirm,body:x.type==="user"?e.removeUserMessage:e.deleteTeamMessage,confirmLabel:x.type==="user"?e.remove:e.delete,blocked:!1}),$(s),N(!0))}else K({title:e.removeItemsConfirm.replace("{count}",s.length.toString()),body:e.removeItemsMessage,confirmLabel:e.remove,blocked:!1}),$(s),N(!0)},children:e.remove})]})})})(),f?L("div",{className:"acm-structure-panel",children:[o?L("div",{className:"acm-structure-working","aria-live":"polite",children:[t(ue,{size:"small"})," ",e.processing]}):null,f==="user"?(()=>{const a=T!=null&&T.size?Array.from(T):g?[g]:[],c=a.length?n==null?void 0:n.find(s=>s.id===a[0]):void 0,h=(c==null?void 0:c.id)??te;return t(Me,{mode:_,entityId:c==null?void 0:c.entityId,parentStructureId:h,permissions:u,onSaved:s=>{_==="add"?s.structureId&&(U({id:s.structureId,parentId:h,label:s.label,type:s.type,entityId:s.entityId}),s.structureId&&(k(s.structureId),M(new Set([s.structureId])))):a.length&&(s.status==="INACTIVE"?j(a):Y(a,s.label)),X()},onCancel:X,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null,f==="team"?(()=>{const a=T!=null&&T.size?Array.from(T):g?[g]:[],c=a.length?n==null?void 0:n.find(s=>s.id===a[0]):void 0,h=(c==null?void 0:c.id)??te;return t(ze,{mode:_,entityId:c==null?void 0:c.entityId,parentStructureId:h,permissions:u,onSaved:s=>{_==="add"?s.structureId&&(U({id:s.structureId,parentId:h,label:s.label,type:s.type,entityId:s.entityId,description:s.description}),s.structureId&&(k(s.structureId),M(new Set([s.structureId])))):a.length&&Y(a,s.label,s.description),X()},onCancel:X,onError:s=>{i({text:s,type:"error"})},onSuccess:s=>{i({text:s,type:"success"})}})})():null]}):null,L(ae,{variant:"secondary",className:`acm-structure-tree-card ${o?"is-working":""}`,children:[S&&S.text?t(ne,{className:"acm-structure-panel__notification",type:S.type||"success",variant:"secondary",heading:S.text}):null,!m&&!o&&n&&n.length===0?t(ne,{className:"acm-structure-panel__notification",type:"warning",variant:"secondary",heading:e.noStructureData}):null,!m&&o?t("div",{className:"acm-structure-tree-overlay","aria-live":"polite",children:t(ue,{size:"medium"})}):null,m?t("div",{className:"acm-structure-tree-content",children:t(Ve,{rows:8})}):t("div",{className:"acm-structure-tree-content",children:t(Ne,{rootId:null,items:r,expandedIds:y,selectedId:g,selectedIds:T,onExpandedChange:C,onSelectedChange:k,onSelectedIdsChange:M,renderExpander:({expanded:a,toggle:c})=>t("button",{type:"button",className:`acm-structure-expander acm-structure-expander-button ${a?"is-open":""}`,"aria-label":a?e.collapse:e.expand,onClick:h=>{h.stopPropagation(),c()},children:a?"âˆ’":"+"}),renderNode:({item:a,hasChildren:c,select:h,expander:s,checkbox:x,icon:z})=>{var J;return L("div",{className:"acm-structure-row",onClick:h,children:[c?s?t("span",{onClick:B=>B.stopPropagation(),children:s()}):t("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}):t("span",{className:"acm-structure-expander acm-structure-expander--placeholder"}),t("span",{className:"acm-structure-handle","aria-hidden":!0}),z?t("span",{onClick:B=>B.stopPropagation(),children:z()}):t("span",{className:`acm-structure-icon ${((J=n==null?void 0:n.find(B=>B.id===a.id))==null?void 0:J.type)==="team"?"is-team":"is-user"}`,"aria-hidden":!0}),x?t("span",{onClick:B=>B.stopPropagation(),children:x()}):null,t("span",{className:"acm-structure-label",children:a.label}),(()=>{const B=n==null?void 0:n.find(oe=>oe.id===a.id),de=(B==null?void 0:B.type)==="team"&&B.description||"";return de?t(P,{type:"button",variant:"secondary",onClick:oe=>{oe.stopPropagation(),ee({id:a.id,text:de})},"aria-label":e.showDescription,className:"acm-structure-description-button",children:"?"}):null})()]})},draggable:()=>!o&&p,canDrop:(a,c)=>{if(!p||a===c)return!1;const h=n==null?void 0:n.find(s=>s.id===a);return h&&h.parentId===c?!1:!l(c,a)},onMove:async({id:a,newParentId:c})=>{p&&await V(a,c)}})})]}),D?t(fe,{open:D,onClose:()=>{o||(N(!1),$([]))},children:L("div",{className:"acm-structure-modal-content",children:[t("h3",{className:"acm-structure-modal-title",children:Z.title}),t("div",{children:Z.body}),t("div",{className:"acm-structure-modal-actions",children:Z.blocked?t(P,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(N(!1),$([]))},children:e.ok}):L(me,{children:[t(P,{type:"button",variant:"secondary",disabled:o,onClick:()=>{o||(N(!1),$([]))},children:e.cancel}),t(P,{type:"button",variant:"primary",disabled:o,onClick:async()=>{await j(q),N(!1),$([])},children:o?Z.confirmLabel===e.delete?e.deleting:e.removing:Z.confirmLabel||e.remove})]})})]})}):null,Q?t(fe,{open:!!Q,onClose:()=>ee(null),children:L("div",{className:"acm-structure-modal-content",children:[t("h3",{className:"acm-structure-modal-title",children:e.teamDescription}),t("div",{children:Q.text}),t("div",{className:"acm-structure-modal-actions",children:t(P,{type:"button",variant:"secondary",onClick:()=>ee(null),children:e.close})})]})}):null]});return w!=null&&w.StructureData?t(be,{name:"StructureData",slot:w.StructureData,context:{structureData:A,Default:O}}):O}),Ye=()=>{const u=W({fetchPermissionsError:"Company.CompanyStructure.messages.fetchPermissionsError"}),[w,p]=I(null),[d,e]=I(!0),[S,i]=I(null),n=H(async()=>{var m,o;try{e(!0),i(null);const{roleResponse:y}=await Ce(),C=(o=(m=y==null?void 0:y.data)==null?void 0:m.customer)==null?void 0:o.role,g=ge(C);p(g)}catch(y){i(y instanceof Error?y:new Error(u.fetchPermissionsError))}finally{e(!1)}},[u.fetchPermissionsError]);return G(()=>{let m=!0;return(async()=>{var y,C;try{e(!0),i(null);const{roleResponse:g}=await Ce();if(!m)return;const k=(C=(y=g==null?void 0:g.data)==null?void 0:y.customer)==null?void 0:C.role,T=ge(k);p(T)}catch(g){if(!m)return;i(g instanceof Error?g:new Error(u.fetchPermissionsError))}finally{m&&e(!1)}})(),()=>{m=!1}},[]),{permissions:w,loading:d,error:S,refreshPermissions:n}},qe="/customer/company/create",$e=({className:u,children:w,createCompanyAccountUrl:p=qe,...d})=>{const e=W({individualUserMessage:"Company.CustomerCompanyInfo.individualUserMessage",createAccountCta:"Company.CustomerCompanyInfo.createAccountCta"}),S=e.individualUserMessage||"You don't have a company account yet.";return t(ae,{variant:"secondary",className:Se(["company-management-company-structure-card",u]),...d,children:L("div",{children:[t(ne,{type:"warning",variant:"secondary",heading:S,icon:t(Re,{}),className:"company-management-company-structure-card__alert","data-testid":"company-structure-inline-alert"}),t("div",{className:"company-management-company-structure-card__cta",children:t(P,{as:"a",href:p,variant:"primary","data-testid":"company-structure-create-company-button",children:e.createAccountCta||"Create a Company Account"})})]})})},ft=({className:u,withHeader:w=!1,slots:p,isAuthenticated:d=!1,onRedirectLogin:e,onRedirectAccount:S})=>{const i=W({containerTitle:"Company.CompanyStructure.containerTitle"}),{permissions:n,refreshPermissions:m}=Ye(),[o,y]=I("loading");return Te(m),G(()=>{let C=!0;return(async()=>{try{if(!d){C&&y("redirect-login");return}if(!await Ee()){C&&(console.log("Company registration disabled - redirecting to account dashboard"),y("redirect-account"));return}await we()?C&&y("show-structure"):C&&y("show-empty")}catch(g){console.error("Error in CompanyStructure - redirecting to login page:",g),C&&y("redirect-login")}})(),()=>{C=!1}},[d]),G(()=>{o==="redirect-login"&&e&&e(),o==="redirect-account"&&S&&S()},[o,e,S]),o==="loading"||o==="redirect-login"||o==="redirect-account"?null:o==="show-empty"?t($e,{className:u}):o==="show-structure"?L("div",{className:Se(["account-company-structure",u]),children:[w?t(Ie,{title:i.containerTitle,divider:!1,className:"company-structure__title"}):null,t(He,{slots:p,permissions:n})]}):null};export{ft as CompanyStructure,ft as default};
//# sourceMappingURL=CompanyStructure.js.map
