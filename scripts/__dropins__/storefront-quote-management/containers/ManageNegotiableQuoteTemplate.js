/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as a,jsxs as p,Fragment as Se}from"@dropins/tools/preact-jsx-runtime.js";import{useState as m,useEffect as ue,useCallback as s,useMemo as M,useRef as $a,createPortal as O}from"@dropins/tools/preact-compat.js";import{classes as u,VComponent as D,Slot as R}from"@dropins/tools/lib.js";import{f as na}from"../chunks/dateUtils.js";import{events as Ga}from"@dropins/tools/event-bus.js";import{Skeleton as Pa,SkeletonRow as $,InLineAlert as L,Modal as ja,Input as ye,Button as A,TextArea as Ka,InputFile as Va,Icon as se}from"@dropins/tools/components.js";import{N as ta}from"../chunks/transform-quote-template.js";import{S as Ja,A as Xa,T as Ya,R as Za}from"../chunks/RenameQuoteModal.js";import{v as en,f as an,a as nn,S as tn,A as rn}from"../chunks/AttachedFilesList.js";/* empty css                              */import"@dropins/tools/preact.js";import"@dropins/tools/preact-hooks.js";import{C as de}from"../chunks/ConfirmationModal.js";/* empty css                        *//* empty css                          */import{S as G}from"../chunks/WarningFilled.js";import{useText as De}from"@dropins/tools/i18n.js";import"../chunks/state.js";import{u as on}from"../chunks/uploadFile.js";import{d as cn,c as ln,s as mn,a as sn,o as dn}from"../chunks/openQuoteTemplate.js";import{g as un}from"../chunks/generateQuoteFromTemplate.js";import{S as gn}from"../chunks/ShippingAddressDisplay.js";import{I as fn}from"../chunks/ItemsQuotedTemplate.js";import{Q as pn}from"../chunks/QuoteTemplateCommentsList.js";import{Q as bn}from"../chunks/QuoteTemplateHistoryLog.js";import{S as Re}from"../chunks/CheckWithCircle.js";import"../chunks/transform-quote.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/NegotiableQuoteTemplateFragment.js";import"../chunks/LineItemNoteModal.js";import"../chunks/addQuoteTemplateLineItemNote.js";import"../chunks/QuoteCommentsList.js";import"../chunks/QuoteHistoryLog.js";const hn=({className:n,loading:f,templateName:l,templateStatus:T,banner:C,details:h,actionBar:S,referenceDocuments:e,itemsTable:_,shippingInformationTitle:c,shippingInformation:o,commentsTitle:N,comments:b,attachFilesField:d,attachedFilesList:y,footer:E,...Q})=>f?a(Mn,{}):p("div",{...Q,className:u(["quote-management-manage-negotiable-quote-template",n]),children:[p("div",{className:u(["quote-management-manage-negotiable-quote-template__header"]),children:[l&&a(D,{node:l,className:u(["quote-management-manage-negotiable-quote-template__template-name"])}),T&&a(D,{node:T,className:u(["quote-management-manage-negotiable-quote-template__template-status"])})]}),C&&a(D,{node:C,className:u(["quote-management-manage-negotiable-quote-template__banner"])}),h&&a(D,{node:h,className:u(["quote-management-manage-negotiable-quote-template__details"])}),S&&a(D,{node:S,className:u(["quote-management-manage-negotiable-quote-template__action-bar"])}),e&&a("div",{"data-testid":"reference-documents-container",className:u(["quote-management-manage-negotiable-quote-template__reference-documents-container"]),children:a(D,{node:e,className:u(["quote-management-manage-negotiable-quote-template__reference-documents"])})}),_&&a(D,{node:_,className:u(["quote-management-manage-negotiable-quote-template__items-table"])}),p("div",{"data-testid":"template-shipping-information-container",className:u(["quote-management-manage-negotiable-quote-template__shipping-information-container"]),children:[c&&a(D,{node:c,className:u(["quote-management-manage-negotiable-quote-template__shipping-information-title"])}),o&&a(D,{node:o,className:u(["quote-management-manage-negotiable-quote-template__shipping-information"])})]}),p("div",{"data-testid":"comments-container",className:u(["quote-management-manage-negotiable-quote-template__comments-container"]),children:[N&&a(D,{node:N,className:u(["quote-management-manage-negotiable-quote-template__comments-title"])}),b&&a(D,{node:b,className:u(["quote-management-manage-negotiable-quote-template__comments"])}),d&&a(D,{node:d,className:u(["quote-management-manage-negotiable-quote-template__attach-files-field"])}),y&&a(D,{node:y,className:u(["quote-management-manage-negotiable-quote-template__attached-files-list"])})]}),E&&a(D,{node:E,className:u(["quote-management-manage-negotiable-quote-template__footer"])})]}),Mn=()=>p(Pa,{"data-testid":"manage-negotiable-quote-template-skeleton",children:[a($,{variant:"heading",fullWidth:!0,size:"large"}),a($,{variant:"row",fullWidth:!1,size:"small"}),a($,{variant:"row",fullWidth:!1,size:"small"}),a($,{variant:"row",fullWidth:!0}),a($,{variant:"row",fullWidth:!0,size:"xlarge",lines:2}),a($,{variant:"row",fullWidth:!1,size:"small"})]}),Nn=({className:n,open:f,document:l,errorMessage:T,errorBanner:C,successBanner:h,showCloseButton:S=!0,isSubmitting:e=!1,onSave:_,onClose:c})=>{const[o,N]=m(""),[b,d]=m(""),[y,E]=m(""),[Q,w]=m({}),v=De({title:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.title",documentNameLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameLabel",documentIdentifierLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierLabel",referenceUrlLabel:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlLabel",addButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.addButton",updateButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.updateButton",cancelButton:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.cancelButton",documentNameRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentNameRequired",documentIdentifierRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.documentIdentifierRequired",referenceUrlRequired:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.referenceUrlRequired",invalidUrl:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.invalidUrl",errorHeading:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.errorHeading"}),z=C||(T?a(L,{type:"error",variant:"primary",icon:a(G,{}),heading:v.errorHeading,description:T,"data-testid":"reference-document-form-modal-error-banner-inline"}):null),B=!!l;ue(()=>{f&&(l?(N(l.name||""),d(l.identifier||""),E(l.url||"")):(N(""),d(""),E("")),w({}))},[f,l]);const F=s(q=>{if(!q.trim())return!1;try{return new URL(q),!0}catch{return!1}},[]),P=s(()=>{const q={};if(o.trim()||(q.documentName=v.documentNameRequired),y.trim()?F(y.trim())||(q.referenceUrl=v.invalidUrl):q.referenceUrl=v.referenceUrlRequired,b.trim()||(q.documentIdentifier=v.documentIdentifierRequired),Object.keys(q).length>0){w(q);return}_({uid:l==null?void 0:l.uid,name:o.trim(),identifier:b.trim(),url:y.trim()})},[o,b,y,l,v,F,_]),j=s(()=>{N(""),d(""),E(""),w({}),c==null||c()},[c]);return f?p(ja,{open:f,size:"medium",title:a(Se,{children:v.title}),onClose:j,clickToDismiss:!0,escapeToDismiss:!0,showCloseButton:S,className:u(["quote-management-reference-document-form-modal",n]),"data-testid":"reference-document-form-modal",children:[z&&a("div",{className:u(["quote-management-reference-document-form-modal__error-banner"]),"data-testid":"reference-document-form-modal-error-banner",children:z}),h&&a("div",{className:u(["quote-management-reference-document-form-modal__success-banner"]),"data-testid":"reference-document-form-modal-success-banner",children:h}),p("div",{className:u(["quote-management-reference-document-form-modal__content"]),children:[p("div",{children:[a(ye,{name:"documentName",type:"text",value:o,onInput:q=>{N(q.target.value),w({...Q,documentName:void 0})},floatingLabel:v.documentNameLabel,required:!0,error:!!Q.documentName,disabled:e,"data-testid":"reference-document-name-input"}),Q.documentName&&a("span",{className:u(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-name-error",children:Q.documentName})]}),p("div",{children:[a(ye,{name:"documentIdentifier",type:"text",value:b,onInput:q=>{d(q.target.value),w({...Q,documentIdentifier:void 0})},floatingLabel:v.documentIdentifierLabel,error:!!Q.documentIdentifier,disabled:e,"data-testid":"reference-document-identifier-input"}),Q.documentIdentifier&&a("span",{className:u(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-identifier-error",children:Q.documentIdentifier})]}),p("div",{children:[a(ye,{name:"referenceUrl",type:"url",value:y,onInput:q=>{E(q.target.value),w({...Q,referenceUrl:void 0})},floatingLabel:v.referenceUrlLabel,required:!0,error:!!Q.referenceUrl,disabled:e,"data-testid":"reference-document-url-input"}),Q.referenceUrl&&a("span",{className:u(["quote-management-reference-document-form-modal__error-text"]),"data-testid":"reference-document-url-error",children:Q.referenceUrl})]})]}),p("div",{className:u(["quote-management-reference-document-form-modal__actions"]),children:[a(A,{variant:"secondary",size:"medium",onClick:j,disabled:e,className:u(["quote-management-reference-document-form-modal__cancel-button"]),"data-testid":"reference-document-form-cancel-button",children:v.cancelButton}),a(A,{variant:"primary",size:"medium",onClick:P,disabled:e,className:u(["quote-management-reference-document-form-modal__save-button"]),"data-testid":"reference-document-form-save-button",children:B?v.updateButton:v.addButton})]})]}):null},Tn=({className:n,documents:f,isEditable:l=!1,onAdd:T,onEdit:C,onRemove:h,...S})=>{const e=De({add:"NegotiableQuoteTemplate.Manage.referenceDocuments.add",edit:"NegotiableQuoteTemplate.Manage.referenceDocuments.edit",remove:"NegotiableQuoteTemplate.Manage.referenceDocuments.remove",noReferenceDocuments:"NegotiableQuoteTemplate.Manage.referenceDocuments.noReferenceDocuments"}),_=o=>o.identifier?`${o.name}, ${o.identifier}`:`${o.name} ${o.url}`,c=(o,N)=>{o.preventDefault(),window.open(N,"_blank","noopener,noreferrer")};return a("div",{className:u(["quote-management-reference-documents-list",n]),"data-testid":"reference-documents-list",...S,children:p("div",{className:"quote-management-reference-documents-list__content",children:[f.map(o=>p("div",{className:"quote-management-reference-documents-list__document","data-testid":`reference-document-${o.uid||o.url}`,children:[a("a",{href:o.url,onClick:N=>c(N,o.url),className:"quote-management-reference-documents-list__document-link",target:"_blank",rel:"noopener noreferrer","data-testid":`reference-document-link-${o.uid||o.url}`,children:_(o)}),l&&p("div",{className:"quote-management-reference-documents-list__document-actions",children:[a(A,{variant:"tertiary",onClick:()=>C==null?void 0:C(o),className:"quote-management-reference-documents-list__edit-button","data-testid":`reference-document-edit-${o.uid||o.url}`,children:e.edit}),a("span",{className:"quote-management-reference-documents-list__separator",children:"|"}),a(A,{variant:"tertiary",onClick:()=>h==null?void 0:h(o),className:"quote-management-reference-documents-list__remove-button","data-testid":`reference-document-remove-${o.uid||o.url}`,children:e.remove})]})]},o.uid||o.url)),l&&p(A,{variant:"tertiary",onClick:T,className:"quote-management-reference-documents-list__add-button","data-testid":"reference-documents-add-button",children:["+ ",e.add]}),f.length===0&&!l&&a("div",{className:"quote-management-reference-documents-list__empty",children:e.noReferenceDocuments})]})})},Qn=n=>{const{templateReferenceDocuments:f,localReferenceDocuments:l}=n,T=s(c=>{if(f)return f.find(o=>c.uid&&o.uid?o.uid===c.uid:o.url===c.url)},[f]),C=s(c=>T(c)!==void 0,[T]),h=s((c,o)=>c.name!==o.name||c.identifier!==o.identifier||c.url!==o.url,[]),S=s(()=>f?l.filter(c=>!f.some(o=>c.uid&&o.uid?o.uid===c.uid:o.url===c.url)):l,[f,l]),e=s(()=>l.map(c=>({uid:c.uid,name:c.name,identifier:c.identifier,url:c.url})),[l]),_=M(()=>f?l.some(b=>T(b)===void 0)||f.some(b=>!l.some(d=>d.uid&&b.uid?d.uid===b.uid:d.url===b.url))?!0:l.some(b=>{const d=T(b);return d?h(b,d):!1}):l.length>0,[f,l,T,h]);return{isDocumentInTemplateData:C,getNewDocuments:S,getReferenceDocumentLinks:e,hasUnsavedChanges:_}},vn=(n={})=>{const{initialTemplateName:f,templateNameRequiredErrorMessage:l="Template name is required"}=n,[T,C]=m(!1),[h,S]=m(""),[e,_]=m(""),[c,o]=m(""),[N,b]=m(""),[d,y]=m(""),E=s(F=>{S(F||f||""),_(""),o(""),b(""),y(""),C(!0)},[f]),Q=s(()=>{C(!1),S(""),_(""),o(""),b(""),y("")},[]),w=s(F=>{S(F),F.trim()&&b("")},[]),v=s(F=>{_(F)},[]),z=s(()=>h.trim()?(o(""),b(""),C(!1),!0):(b(l),!1),[h,l]),B=s(()=>{S(""),_(""),o(""),b(""),y("")},[]);return{isRenameModalOpen:T,renameTemplateName:h,renameReason:e,renameError:c,renameTemplateNameError:N,renameSuccess:d,handleRenameClick:E,handleRenameClose:Q,handleRenameTemplateNameChange:w,handleRenameReasonChange:v,handleRenameSave:z,resetRenameState:B}},rt=({slots:n,onActionsButtonClick:f,onSendForReview:l,maxFiles:T,maxFileSize:C,acceptedFileTypes:h,...S})=>{var aa;const[e,_]=m(void 0),[c,o]=m(!0),[N,b]=m(""),[d,y]=m(!1),[E,Q]=m(!1),[w,v]=m(null),[z,B]=m(!1),[F,P]=m(!1),[j,q]=m(null),[ra,K]=m(!1),[x,V]=m([]),[Le,ee]=m(!1),[ae,ne]=m(void 0),[oa,te]=m(null),[Ee,Fe]=m(!1),[ke,Ie]=m(!1),[we,re]=m(""),[He,oe]=m(""),[Ae,ge]=m(!1),[Be,xe]=m(!1),[Ue,J]=m(""),[We,ie]=m(""),ze=$a(!1),[k,X]=m([]),[ce,le]=m(void 0),{getReferenceDocumentLinks:Oe,hasUnsavedChanges:$e}=Qn({templateReferenceDocuments:e==null?void 0:e.referenceDocuments,localReferenceDocuments:x}),t=De({createdLabel:"NegotiableQuoteTemplate.Manage.createdLabel",salesRepLabel:"NegotiableQuoteTemplate.Manage.salesRepLabel",expiresLabel:"NegotiableQuoteTemplate.Manage.expiresLabel",templateIdLabel:"NegotiableQuoteTemplate.Manage.templateIdLabel",actionsLabel:"NegotiableQuoteTemplate.Manage.actionsLabel",referenceDocumentsTitle:"NegotiableQuoteTemplate.Manage.referenceDocuments.title",commentsTitle:"NegotiableQuoteTemplate.Manage.comments.title",historyLogTitle:"NegotiableQuoteTemplate.Manage.historyLog.title",itemsQuotedTab:"NegotiableQuoteTemplate.Manage.tabs.itemsQuoted",commentsTab:"NegotiableQuoteTemplate.Manage.tabs.comments",historyLogTab:"NegotiableQuoteTemplate.Manage.tabs.historyLog",templateCommentsPlaceholder:"NegotiableQuoteTemplate.Manage.templateComments.placeholder",sendForReview:"NegotiableQuoteTemplate.Manage.actionButtons.sendForReview",delete:"NegotiableQuoteTemplate.Manage.actionButtons.delete",cancel:"NegotiableQuoteTemplate.Manage.actionButtons.cancel",attachFiles:"NegotiableQuote.Manage.attachFiles",fileUploadError:"NegotiableQuote.Manage.fileUploadError",maxFilesExceeded:"NegotiableQuote.Manage.maxFilesExceeded",maxFileSizeExceeded:"NegotiableQuote.Manage.maxFileSizeExceeded",invalidFileType:"NegotiableQuote.Manage.invalidFileType",confirmationModalDeleteTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.title",confirmationModalDeleteMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.message",confirmationModalDeleteConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.confirm",confirmationModalDeleteErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorHeading",confirmationModalDeleteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.errorFallback",confirmationModalDeleteSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successHeading",confirmationModalDeleteSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.delete.successDescription",confirmationModalCancelTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.title",confirmationModalCancelMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.message",confirmationModalCancelConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.confirm",confirmationModalCancelErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorHeading",confirmationModalCancelErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.errorFallback",confirmationModalCancelSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successHeading",confirmationModalCancelSuccessDescription:"NegotiableQuoteTemplate.Manage.confirmationModal.cancelTemplate.successDescription",confirmationModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",accept:"NegotiableQuoteTemplate.Manage.actionButtons.accept",generateQuote:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalTitle:"NegotiableQuoteTemplate.Manage.actionButtons.generateQuote",generateQuoteModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.message",generateQuoteModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",generateQuoteModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirm",generateQuoteModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.confirmLoading",generateQuoteModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successHeading",generateQuoteSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.successDescription",generateQuoteModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorHeading",generateQuoteErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.generateQuote.errorFallback",acceptModalTitle:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.title",acceptModalMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.message",acceptModalCancel:"NegotiableQuoteTemplate.Manage.confirmationModal.cancel",acceptModalConfirm:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirm",acceptModalConfirmLoading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.confirmLoading",acceptModalSuccessHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successHeading",acceptSuccessMessage:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.successDescription",acceptModalErrorHeading:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorHeading",acceptErrorFallback:"NegotiableQuoteTemplate.Manage.confirmationModal.accept.errorFallback",documentDuplicateUidError:"NegotiableQuoteTemplate.Manage.referenceDocuments.form.duplicateUidError",renameTitle:"NegotiableQuoteTemplate.Manage.rename.title",renameTemplateNameLabel:"NegotiableQuoteTemplate.Manage.rename.templateNameLabel",renameReasonLabel:"NegotiableQuoteTemplate.Manage.rename.reasonLabel",renameButton:"NegotiableQuoteTemplate.Manage.rename.renameButton",renameCancelButton:"NegotiableQuoteTemplate.Manage.rename.cancelButton",renameErrorHeading:"NegotiableQuoteTemplate.Manage.rename.errorHeading",renameTemplateNameRequired:"NegotiableQuoteTemplate.Manage.rename.templateNameRequired",renameErrorDefault:"NegotiableQuoteTemplate.Manage.rename.errorDefault",renameSuccessHeading:"NegotiableQuoteTemplate.Manage.rename.successHeading",renameSuccessMessage:"NegotiableQuoteTemplate.Manage.rename.successMessage",shippingInformationTitle:"NegotiableQuoteTemplate.Manage.shippingInformation.title",unsavedChangesWarningHeading:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningHeading",unsavedChangesWarningMessage:"NegotiableQuoteTemplate.Manage.unsavedChangesWarningMessage",shippingAddressWarningHeading:"NegotiableQuoteTemplate.Manage.shippingAddressWarningHeading",shippingAddressWarningMessage:"NegotiableQuoteTemplate.Manage.shippingAddressWarningMessage"}),{isRenameModalOpen:Ge,renameTemplateName:I,renameReason:Y,renameError:fe,renameTemplateNameError:ia,renameSuccess:pe,handleRenameClick:Pe,handleRenameClose:ca,handleRenameTemplateNameChange:la,handleRenameReasonChange:ma,handleRenameSave:sa,resetRenameState:je}=vn({initialTemplateName:e==null?void 0:e.name,templateNameRequiredErrorMessage:t.renameTemplateNameRequired}),Ke=M(()=>I!==""&&I!==(e==null?void 0:e.name),[I,e==null?void 0:e.name]),Z=M(()=>$e||Ke,[$e,Ke]),be=s(async r=>{if(T&&k.length+r.length>T){le(t.maxFilesExceeded.replace("{maxFiles}",String(T)));return}for(const g of r){if(C&&!en(g.size,C)){le(t.maxFileSizeExceeded.replace("{maxSize}",an(C)));return}if(h&&!nn(g.type,h)){le(t.invalidFileType);return}}le(void 0);const i=r.map(g=>({key:`temp-${Date.now()}-${Math.random()}-${g.name}`,name:g.name,size:g.size,status:"uploading"}));X(g=>[...g,...i]);for(let g=0;g<r.length;g++){const U=r[g],H=i[g].key;try{const Ce=await on(U);X(_e=>_e.map(W=>W.key===H?{...W,key:Ce.key,status:"success"}:W))}catch(Ce){X(_e=>_e.map(W=>W.key===H?{...W,status:"error",error:Ce.message}:W))}}},[T,C,h,k,t]),he=s(r=>{X(i=>i.filter(g=>g.key!==r))},[]);ue(()=>{const r=Ga.on("quote-management/quote-template-data",i=>{i.quoteTemplate&&(_(i.quoteTemplate),o(!1),b(""),y(!1),X([]),V(i.quoteTemplate.referenceDocuments||[]),je())},{eager:!0});return()=>r==null?void 0:r.off()},[je]),ue(()=>{e!=null&&e.referenceDocuments&&V(e.referenceDocuments)},[e==null?void 0:e.referenceDocuments]),ue(()=>{e&&e.status===ta.UPDATED&&!ze.current&&(ze.current=!0,(async()=>{try{await dn({templateId:e.id})}catch(i){console.error("Failed to auto-open quote template:",i)}})())},[e]);const da=s(()=>{Q(!1),v(null),B(!1)},[]),ua=s(async()=>{if(e!=null&&e.id){v(null),B(!1);try{await cn({templateId:e.id}),B(!0),setTimeout(()=>{Q(!1),B(!1)},2e3)}catch(r){const i=r.message||t.confirmationModalDeleteErrorFallback;v(i)}}},[e,t.confirmationModalDeleteErrorFallback]),ga=s(()=>{v(null)},[]),fa=s(()=>{B(!1)},[]),pa=s(()=>{P(!1),q(null),K(!1)},[]),ba=s(async()=>{if(e!=null&&e.id){q(null),K(!1);try{await ln({templateId:e.id}),K(!0),setTimeout(()=>{P(!1),K(!1)},2e3)}catch(r){const i=r.message||t.confirmationModalCancelErrorFallback;q(i)}}},[e,t.confirmationModalCancelErrorFallback]),ha=s(()=>{q(null)},[]),Ma=s(()=>{K(!1)},[]),Me=s(async()=>{const r=Oe(),i=k.filter(H=>H.status==="success"),g=[Y.trim(),N.trim()].filter(Boolean).join(`

`).trim()||void 0,U=I&&I!==(e==null?void 0:e.name)?I:void 0;if(l){l({templateData:e,name:U,comment:g,referenceDocumentLinks:r,attachments:i.length?i:void 0});return}y(!0);try{await mn({templateId:e.id,name:U,comment:g,referenceDocumentLinks:r.length>0?r:void 0,attachments:i.length?i.map(H=>({key:H.key})):void 0})}catch(H){console.error("Failed to send quote template for review:",H),y(!1)}},[e,l,N,Y,I,Oe,k]),Ne=s(()=>{ne(void 0),te(null),ee(!0)},[]),Te=s(r=>{ne(r),te(null),ee(!0)},[]),Qe=s(r=>{V(i=>i.filter(g=>g.uid!==r.uid||g.url!==r.url))},[]),Na=s(r=>{te(null),V(ae?i=>i.map(g=>g.identifier===ae.identifier?r:g):i=>[...i,r]),ee(!1),ne(void 0)},[ae]),Ta=s(()=>{ee(!1),ne(void 0),te(null)},[]),Qa=s(async()=>{Ie(!0),oe(""),re("");try{await un({templateId:e.id}),re(t.generateQuoteSuccessMessage)}catch(r){console.error("Failed to generate quote from template:",r);const i=r instanceof Error?r.message:t.generateQuoteErrorFallback;oe(i)}finally{Ie(!1)}},[e,t.generateQuoteSuccessMessage,t.generateQuoteErrorFallback]),va=s(()=>{Fe(!1),oe(""),re("")},[]),qa=s(async()=>{xe(!0),ie(""),J("");try{await sn({templateId:e.id}),J(t.acceptSuccessMessage),setTimeout(()=>{ge(!1),J("")},2e3)}catch(r){console.error("Failed to accept quote template:",r);const i=r instanceof Error?r.message:t.acceptErrorFallback;ie(i)}finally{xe(!1)}},[e,t.acceptSuccessMessage,t.acceptErrorFallback]),Ca=s(()=>{ge(!1),ie(""),J("")},[]),_a=M(()=>{const r=!(e!=null&&e.canSendForReview),i=I||(e==null?void 0:e.name);return a(R,{name:"TemplateName",slot:n==null?void 0:n.TemplateName,context:{templateName:e==null?void 0:e.name,templateData:e,templateDisplayName:i,isRenameDisabled:r},children:p("div",{className:"quote-management-manage-negotiable-quote-template__template-name-wrapper",children:[a("h1",{"data-testid":"template-name",className:"quote-management-manage-negotiable-quote-template__template-name-title",children:i}),a("button",{onClick:()=>Pe(i),disabled:r,"data-testid":"rename-template-button",className:"quote-management-manage-negotiable-quote-template__rename-button","aria-label":"Rename template",children:a(Ja,{})})]})})},[n==null?void 0:n.TemplateName,e,Pe,I]),ya=M(()=>a(R,{name:"TemplateStatus",slot:n==null?void 0:n.TemplateStatus,context:{templateStatus:e==null?void 0:e.status,templateData:e},children:a("div",{"data-testid":"template-status",children:e==null?void 0:e.status})}),[n==null?void 0:n.TemplateStatus,e]),Ra=M(()=>{if(!e)return;const r=e.expirationDate?na(e.expirationDate,"short"):void 0;return p(R,{name:"Details",slot:n==null?void 0:n.Details,context:{templateData:e},children:[p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"template-id-label",children:t.templateIdLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"template-id-value",children:e.id})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"created-label",children:t.createdLabel}),p("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"created-value",children:[na(e.createdAt,"short")," (",e.buyer.firstname," ",e.buyer.lastname,")"]})]}),p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"sales-rep-label",children:t.salesRepLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"sales-rep-value",children:e.salesRepName})]}),r&&p("div",{className:"quote-management-manage-negotiable-quote-template__detail",children:[a("span",{className:"quote-management-manage-negotiable-quote-template__detail-title","data-testid":"expires-label",children:t.expiresLabel}),a("span",{className:"quote-management-manage-negotiable-quote-template__detail-content","data-testid":"expires-value",children:r})]})]})},[n==null?void 0:n.Details,t,e]),Ve=M(()=>[{label:t.generateQuote,value:"generateQuote",disabled:!(e!=null&&e.canGenerateQuoteFromTemplate)}],[t,e==null?void 0:e.canGenerateQuoteFromTemplate]),Sa=M(()=>{const r=i=>{switch(i){case"generateQuote":Fe(!0),oe(""),re(""),f==null||f(i);break}};return a(R,{name:"ActionBar",slot:n==null?void 0:n.ActionBar,context:{templateData:e},children:a(Xa,{dropdownPlaceholder:t.actionsLabel,dropdownOptions:[],buttons:Ve.map(i=>a(A,{variant:"tertiary",onClick:()=>r(i.value),"data-testid":`actions-bar-${i.value}-button`,"data-action":i.value,disabled:i.disabled,children:i.label},i.value))})})},[Ve,t,n==null?void 0:n.ActionBar,e,f]),me=M(()=>{const r=e==null?void 0:e.status;return r==="Draft"||r==="Open"},[e==null?void 0:e.status]),Da=M(()=>{const r=x.length>0||me,i=r?t.referenceDocumentsTitle:void 0;return a(R,{name:"ReferenceDocuments",slot:n==null?void 0:n.ReferenceDocuments,context:{templateData:e,referenceDocuments:x,isEditable:me,onAddDocument:Ne,onEditDocument:Te,onRemoveDocument:Qe,referenceDocumentsTitle:t.referenceDocumentsTitle},children:p("div",{"data-testid":"reference-documents",children:[r&&a("h2",{children:i}),a(Tn,{documents:x,isEditable:me,onAdd:Ne,onEdit:Te,onRemove:Qe})]})})},[n==null?void 0:n.ReferenceDocuments,t,e,x,me,Ne,Te,Qe]),La=M(()=>a(R,{name:"ShippingInformationTitle",slot:n==null?void 0:n.ShippingInformationTitle,context:{templateData:e},children:a("h2",{children:t.shippingInformationTitle})}),[n==null?void 0:n.ShippingInformationTitle,e,t]),Ea=M(()=>{var r;return a(R,{name:"ShippingInformation",slot:n==null?void 0:n.ShippingInformation,context:{templateData:e,loading:c,setLoading:o},children:a(gn,{shippingAddress:(r=e==null?void 0:e.shippingAddresses)==null?void 0:r[0],loading:c,"data-testid":"manage-template-shipping-address"})})},[n==null?void 0:n.ShippingInformation,e,c,o]),Fa=M(()=>a(R,{name:"ItemsTable",slot:n==null?void 0:n.ItemsTable,context:{templateData:e},children:a(Ya,{tabs:new Map([["items-quoted",t.itemsQuotedTab],["comments",t.commentsTab],["history-log",t.historyLogTab]]),tabsContent:new Map([["items-quoted",a(R,{name:"ItemsQuotedTab",slot:n==null?void 0:n.ItemsQuotedTab,context:{templateData:e},children:a(fn,{templateData:e})},"items-quoted")],["comments",a(R,{name:"CommentsTab",slot:n==null?void 0:n.CommentsTab,context:{templateData:e},children:a(pn,{templateData:e})},"comments")],["history-log",a(R,{name:"HistoryLogTab",slot:n==null?void 0:n.HistoryLogTab,context:{templateData:e},children:a(bn,{templateData:e})},"history-log")]])})}),[n==null?void 0:n.ItemsTable,n==null?void 0:n.ItemsQuotedTab,n==null?void 0:n.CommentsTab,n==null?void 0:n.HistoryLogTab,t,e]),ka=M(()=>a(R,{name:"CommentsTitle",slot:n==null?void 0:n.CommentsTitle,context:{templateData:e},children:a("h2",{children:t.commentsTitle})}),[n==null?void 0:n.CommentsTitle,t,e]),Ia=M(()=>a(R,{name:"Comments",slot:n==null?void 0:n.Comments,context:{templateData:e},children:a(Ka,{name:"templateComments",placeholder:t.templateCommentsPlaceholder,rows:3,value:N,onInput:r=>{b(r.target.value)},disabled:!(e!=null&&e.canSendForReview)||d})}),[n==null?void 0:n.Comments,t,e,N,d]),Je=M(()=>!(e!=null&&e.canSendForReview),[e]),wa=M(()=>{const r=d||Je;return a(R,{name:"AttachFilesField",slot:n==null?void 0:n.AttachFilesField,context:{templateData:e,onFileChange:be,attachedFiles:k,fileUploadError:ce,disabled:r},children:p("div",{className:"quote-management-manage-negotiable-quote-template__attach-files",...r?{"data-disabled":!0}:{},"aria-disabled":r,children:[a(Va,{id:"manage-template-attach-files",multiple:!0,onChange:i=>{const g=i.target,U=g==null?void 0:g.files,H=U?Array.from(U):[];H.length>0&&be(H)},icon:a(tn,{}),disabled:r,"data-testid":"manage-template-attach-files",accept:h==null?void 0:h.join(","),children:t.attachFiles}),ce&&a("div",{className:"quote-management-manage-negotiable-quote-template__file-error","data-testid":"file-upload-error",children:ce})]})})},[n==null?void 0:n.AttachFilesField,e,be,d,Je,h,ce,t,k]),Ha=M(()=>{if(k.length)return a(R,{name:"AttachedFilesList",slot:n==null?void 0:n.AttachedFilesList,context:{templateData:e,files:k,onRemove:he,disabled:d},children:a(rn,{files:k,onRemove:he,disabled:d})})},[k,he,d,n==null?void 0:n.AttachedFilesList,e]),Xe=M(()=>Z?a(L,{type:"warning",variant:"primary",icon:a(G,{}),heading:t.unsavedChangesWarningHeading,description:t.unsavedChangesWarningMessage,"data-testid":"unsaved-changes-warning-alert"}):void 0,[Z,t.unsavedChangesWarningHeading,t.unsavedChangesWarningMessage]),Ye=M(()=>{var r;return(r=e==null?void 0:e.shippingAddresses)!=null&&r.length?void 0:a(L,{type:"warning",variant:"primary",icon:a(G,{}),heading:t.shippingAddressWarningHeading,description:t.shippingAddressWarningMessage,"data-testid":"shipping-address-warning-alert"})},[(aa=e==null?void 0:e.shippingAddresses)==null?void 0:aa.length,t.shippingAddressWarningHeading,t.shippingAddressWarningMessage]),Aa=M(()=>p(Se,{children:[Xe,Ye]}),[Xe,Ye]),Ba=M(()=>{const r=(e==null?void 0:e.status)===ta.OPEN&&(e==null?void 0:e.canAccept);return p(R,{name:"Footer",slot:n==null?void 0:n.Footer,context:{templateData:e,comment:N,isSubmitting:d,attachedFiles:k,referenceDocuments:x,hasUnsavedChanges:Z,handleSendForReview:Me,showAcceptButton:r,renameTemplateName:I,renameReason:Y},children:[r&&a(A,{variant:"primary",onClick:()=>{ge(!0),ie(""),J("")},"data-testid":"accept-button",disabled:d||Z,children:t.accept}),(e==null?void 0:e.canSendForReview)&&a(A,{variant:"primary",onClick:Me,"data-testid":"send-for-review-button",disabled:!(e!=null&&e.canSendForReview)||d,children:t.sendForReview}),(e==null?void 0:e.canCancel)&&a(A,{variant:"tertiary",onClick:()=>P(!0),"data-testid":"cancel-template-button",disabled:d,children:t.cancel}),(e==null?void 0:e.canDelete)&&a(A,{variant:"tertiary",onClick:()=>Q(!0),"data-testid":"delete-template-button",disabled:d,children:t.delete})]})},[n==null?void 0:n.Footer,t,e,N,d,k,Me,x,Z,I,Y]),xa=w?a(L,{type:"error",variant:"primary",icon:a(G,{}),heading:t.confirmationModalDeleteErrorHeading,description:w,onDismiss:ga,"data-testid":"confirmation-modal-error-banner"}):null,Ze=(z?a(L,{type:"success",variant:"primary",icon:a(Re,{}),heading:t.confirmationModalDeleteSuccessHeading,description:t.confirmationModalDeleteSuccessDescription,onDismiss:fa,"data-testid":"confirmation-modal-success-banner"}):null)||xa,Ua=j?a(L,{type:"error",variant:"primary",icon:a(G,{}),heading:t.confirmationModalCancelErrorHeading,description:j,onDismiss:ha,"data-testid":"confirmation-modal-cancel-error-banner"}):null,ea=(ra?a(L,{type:"success",variant:"primary",icon:a(Re,{}),heading:t.confirmationModalCancelSuccessHeading,description:t.confirmationModalCancelSuccessDescription,onDismiss:Ma,"data-testid":"confirmation-modal-cancel-success-banner"}):null)||Ua,Wa=M(()=>fe?a(L,{type:"error",variant:"primary",icon:a(G,{color:"var(--color-error)"}),heading:t.renameErrorHeading,description:fe}):void 0,[fe,t.renameErrorHeading]),za=M(()=>pe?a(L,{type:"success",variant:"primary",icon:a(Re,{}),heading:t.renameSuccessHeading,description:pe}):void 0,[pe,t.renameSuccessHeading]),Oa={...S,loading:c,templateName:_a,templateStatus:ya,banner:Aa,details:Ra,actionBar:Sa,referenceDocuments:Da,itemsTable:Fa,shippingInformationTitle:La,shippingInformation:Ea,commentsTitle:ka,comments:Ia,attachFilesField:wa,attachedFilesList:Ha,footer:Ba};let ve=null;we?ve=a(L,{type:"success",variant:"primary",icon:a(se,{source:"CheckWithCircle"}),heading:t.generateQuoteModalSuccessHeading,description:we,"data-testid":"generate-quote-success-banner"}):He&&(ve=a(L,{type:"error",variant:"primary",icon:a(se,{source:"WarningFilled"}),heading:t.generateQuoteModalErrorHeading,description:He,"data-testid":"generate-quote-error-banner"}));let qe=null;return Ue?qe=a(L,{type:"success",variant:"primary",icon:a(se,{source:"CheckWithCircle"}),heading:t.acceptModalSuccessHeading,description:Ue,"data-testid":"accept-success-banner"}):We&&(qe=a(L,{type:"error",variant:"primary",icon:a(se,{source:"WarningFilled"}),heading:t.acceptModalErrorHeading,description:We,"data-testid":"accept-error-banner"})),p(Se,{children:[a(hn,{...Oa}),E&&O(a(de,{open:E,title:t.confirmationModalDeleteTitle,message:t.confirmationModalDeleteMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalDeleteConfirm,onCancel:da,onConfirm:ua,showCloseButton:!Ze,confirmationBanner:Ze}),document.body),F&&O(a(de,{open:F,title:t.confirmationModalCancelTitle,message:t.confirmationModalCancelMessage,cancelLabel:t.confirmationModalCancel,confirmLabel:t.confirmationModalCancelConfirm,onCancel:pa,onConfirm:ba,showCloseButton:!ea,confirmationBanner:ea}),document.body),Le&&O(a(Nn,{open:Le,document:ae,errorMessage:oa||void 0,onSave:Na,onClose:Ta,isSubmitting:d}),document.body),Ee&&O(a(de,{open:Ee,title:t.generateQuoteModalTitle,message:t.generateQuoteModalMessage,cancelLabel:t.generateQuoteModalCancel,confirmLabel:ke?t.generateQuoteModalConfirmLoading:t.generateQuoteModalConfirm,onCancel:va,onConfirm:ke?void 0:Qa,showCloseButton:!0,confirmationBanner:ve,"data-testid":"generate-quote-confirmation-modal"}),document.body),Ae&&O(a(de,{open:Ae,title:t.acceptModalTitle,message:t.acceptModalMessage,cancelLabel:t.acceptModalCancel,confirmLabel:Be?t.acceptModalConfirmLoading:t.acceptModalConfirm,onCancel:Ca,onConfirm:Be?void 0:qa,showCloseButton:!0,confirmationBanner:qe,"data-testid":"accept-confirmation-modal"}),document.body),Ge&&O(a(Za,{open:Ge,quoteName:I,renameReason:Y,quoteNameError:ia,errorBanner:Wa,successBanner:za,onQuoteNameChange:la,onRenameReasonChange:ma,onSave:sa,onClose:ca}),document.body)]})};export{rt as ManageNegotiableQuoteTemplate,rt as default};
//# sourceMappingURL=ManageNegotiableQuoteTemplate.js.map
